@model Edu.Web.Areas.Admin.ViewModels.AdminDashboardVm
@inject Microsoft.Extensions.Localization.IStringLocalizer<SharedResource> L

@{
    ViewData["Title"] = L["Admin.Dashboard"];
}

<!-- Summary cards (keeps 2x2 on xs, 4 on md) -->
<div class="row g-3 mb-3 mt-1">
    <div class="col-6 col-md-3">
        <div class="card shadow-sm text-center h-100">
            <div class="card-body dash-card d-flex flex-column align-items-center justify-content-center gap-2">
                <i class="fa-solid fa-users stat-icon text-primary"></i>
                <div class="small-muted truncate">@L["Admin.TotalRegisteredUsers"]</div>
                <div class="h5 mb-0">@Model.TotalUsers</div>
            </div>
        </div>
    </div>

    <div class="col-6 col-md-3">
        <div class="card shadow-sm text-center h-100">
            <div class="card-body dash-card d-flex flex-column align-items-center justify-content-center gap-2">
                <i class="fa-solid fa-chalkboard-teacher stat-icon text-success"></i>
                <div class="small-muted truncate">@L["Admin.NumOfTeachers"]</div>
                <div class="h5 mb-0">@Model.TotalTeachers</div>
            </div>
        </div>
    </div>

    <div class="col-6 col-md-3">
        <div class="card shadow-sm text-center h-100">
            <div class="card-body dash-card d-flex flex-column align-items-center justify-content-center gap-2">
                <i class="fa-solid fa-user-graduate stat-icon text-info"></i>
                <div class="small-muted truncate">@L["Admin.NumOfStudents"]</div>
                <div class="h5 mb-0">@Model.TotalStudents</div>
            </div>
        </div>
    </div>

    <div class="col-6 col-md-3">
        <div class="card shadow-sm text-center h-100">
            <div class="card-body dash-card d-flex flex-column align-items-center justify-content-center gap-2">
                <i class="fa-solid fa-hourglass-half stat-icon text-warning"></i>
                <div class="small-muted truncate">@L["Teacher.Pending"]</div>
                <div class="h5 mb-0">@Model.PendingTeacherApplications</div>
            </div>
        </div>
    </div>
</div>

<div class="row g-3 mb-3">
    <div class="col-6 col-md-3">
        <div class="card shadow-sm text-center h-100">
            <div class="card-body dash-card d-flex flex-column align-items-center justify-content-center gap-2">
                <i class="fa-solid fa-video stat-icon text-danger"></i>
                <div class="small-muted truncate">@L["Admin.NumOfRecordedCourses"]</div>
                <div class="h5 mb-0">@Model.TotalPrivateCourses</div>
            </div>
        </div>
    </div>

    <div class="col-6 col-md-3">
        <div class="card shadow-sm text-center h-100">
            <div class="card-body dash-card d-flex flex-column align-items-center justify-content-center gap-2">
                <i class="fa-solid fa-book-open stat-icon text-secondary"></i>
                <div class="small-muted truncate">@L["Admin.NumOfCurricula"]</div>
                <div class="h5 mb-0">@Model.TotalCurricula</div>
            </div>
        </div>
    </div>

    <div class="col-6 col-md-3">
        <div class="card shadow-sm text-center h-100">
            <div class="card-body dash-card d-flex flex-column align-items-center justify-content-center gap-2">
                <i class="fa-solid fa-rotate-right stat-icon text-success"></i>
                <div class="small-muted truncate">@L["Admin.NumOfReactiveCourses"]</div>
                <div class="h5 mb-0">@Model.TotalReactiveCourses</div>
            </div>
        </div>
    </div>

    <div class="col-6 col-md-3">
        <div class="card shadow-sm text-center h-100">
            <div class="card-body dash-card d-flex flex-column align-items-center justify-content-center gap-2">
                <i class="fa-solid fa-cart-shopping stat-icon text-warning"></i>
                <div class="small-muted truncate">@L["Admin.NumOfBendingPurchaseRequests"]</div>
                <div class="h5 mb-0">@Model.PendingPurchaseRequests</div>
            </div>
        </div>
    </div>
</div>

<div class="row g-3">
    <!-- Left column: Bookings + Purchase Requests -->
    <div class="col-lg-6">
        <div class="card mb-3">
            <div class="card-header d-flex align-items-center justify-content-between">
                <div><strong>@L["Admin.Bookings"]</strong></div>
            </div>

            <div class="card-body p-0">
                @if (!Model.RecentBookings.Any())
                {
                    <div class="p-3 text-muted small">@L["Admin.NoRecords"]</div>
                }
                else
                {
                    <div class="list-group list-group-flush">
                        @foreach (var b in Model.RecentBookings)
                        {
                            <div class="list-group-item card-list-item d-flex flex-column flex-md-row align-items-start justify-content-between gap-2">
                                <div class="min-w-0">
                                    <div class="fw-semibold truncate">@(!string.IsNullOrEmpty(b.StudentName) ? b.StudentName : ("#" + b.Id))</div>
                                    <div class="meta-small">@b.RequestedDateUtc.ToLocalTime().ToString("g")</div>
                                </div>

                                <div class="text-md-end ms-md-3">
                                    <div class="meta-small">@b.TeacherName</div>
                                    <div class="mt-2">
                                        <a asp-area="Admin" asp-controller="Bookings" asp-action="Details" asp-route-id="@b.Id" class="btn btn-sm btn-outline-secondary w-100 w-md-auto">
                                            @L["Button.View"]
                                        </a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>

        <div class="card">
            <div class="card-header d-flex align-items-center justify-content-between">
                <div><strong>@L["Admin.PurchaseRequestsSubtitle"]</strong></div>
            </div>

            <div class="card-body p-0">
                @if (!Model.RecentPurchaseRequests.Any())
                {
                    <div class="p-3 text-muted small">@L["Admin.NoRecords"]</div>
                }
                else
                {
                    <div class="list-group list-group-flush">
                        @foreach (var pr in Model.RecentPurchaseRequests)
                        {
                            <div class="list-group-item card-list-item d-flex flex-column flex-md-row align-items-start justify-content-between gap-2">
                                <div class="min-w-0">
                                    <div class="fw-semibold truncate">@pr.CourseTitle</div>
                                    <div class="meta-small">@pr.StudentName</div>
                                </div>

                                <div class="text-md-end ms-md-3">
                                    <div class="meta-small">@pr.RequestDateUtc.ToLocalTime().ToString("g")</div>
                                    <div class="mt-2">
                                        <a asp-area="Admin" asp-controller="PurchaseRequests" asp-action="Details" asp-route-id="@pr.Id" class="btn btn-sm btn-outline-secondary w-100 w-md-auto">
                                            @L["Button.View"]
                                        </a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Right column: Reactive Enrollments + Teacher Info -->
    <div class="col-lg-6">
        <div class="card mb-3">
            <div class="card-header d-flex align-items-center justify-content-between">
                <div><strong>@L["Admin.ReactiveEnrollments"]</strong></div>
            </div>

            <div class="card-body p-0">
                @if (!Model.RecentReactiveEnrollments.Any())
                {
                    <div class="p-3 text-muted small">@L["Admin.NoRecords"]</div>
                }
                else
                {
                    <div class="list-group list-group-flush">
                        @foreach (var e in Model.RecentReactiveEnrollments)
                        {
                            <div class="list-group-item card-list-item d-flex flex-column flex-md-row align-items-start justify-content-between gap-2">
                                <div class="min-w-0">
                                    <div class="fw-semibold truncate">@e.CourseTitle</div>
                                    <div class="meta-small">@e.StudentName</div>
                                </div>

                                <div class="text-md-end ms-md-3">
                                    <div class="meta-small">@e.CreatedAtUtc.ToLocalTime().ToString("g")</div>
                                    <div class="mt-2">
                                        <a asp-area="Admin" asp-controller="ReactiveEnrollments" asp-action="Details" asp-route-id="@e.Id" class="btn btn-sm btn-outline-secondary w-100 w-md-auto">
                                            @L["Button.View"]
                                        </a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>

        <div class="card">
            <div class="card-header"><strong>@L["Admin.TeacherInfo"]</strong></div>

            <div class="card-body p-0">
                @if (!Model.RecentTeacherApplications.Any())
                {
                    <div class="p-3 text-muted small">@L["Admin.NoRecords"]</div>
                }
                else
                {
                    <div class="list-group list-group-flush">
                        @foreach (var t in Model.RecentTeacherApplications)
                        {
                            <div class="list-group-item card-list-item d-flex flex-column flex-md-row align-items-start justify-content-between gap-2">
                                <div class="min-w-0">
                                    <div class="fw-semibold truncate">@t.FullName</div>
                                    <div class="meta-small">@t.Email</div>
                                </div>

                                <div class="text-md-end ms-md-3">
                                    <div class="meta-small">@t.Status</div>
                                    <div class="mt-2">
                                        <a asp-controller="ManageUsers" asp-action="Details" asp-route-id="@t.Id" class="btn btn-sm btn-outline-secondary w-100 w-md-auto">
                                            @L["Button.View"]
                                        </a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
</div>


